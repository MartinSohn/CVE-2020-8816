# CVE-2020-8816
**The full PoC is available in the PDF document**

This is a variation of a PoC for RCE on Pi-hole 4.3.2: https://natedotred.wordpress.com/2020/03/28/cve-2020-8816-pi-hole-remote-code-execution/ 

TL;DR of the vulnerability: Pi-hole’s AdminFTL (web interface) incorrectly validates the MAC-address field for static IP-address leases for the built-in DHCP server, this enables RCE by injecting a MAC-address that later is part of a PHP exec: 

    exec("sudo pihole -a addstaticdhcp ".$mac." ".$ip." ".$hostname); 

This vulnerability has one problem: all injected commands/MAC-addresses are made UPPERCASE before being part of execution. Linux is of course case sensitive and uses lowercase for almost everything. 

The original PoC injects the code: 
```bash
${PATH#/???/}&&P=${W%%?????:*}&&X=${PATH#/???/??}&&H=${X%%???:*}&&Z=${PATH#*:/??}&&R=${Z%%/*}&&$P$H$P$IFS-$R$IFS'EXEC(HEX2BIN("<hex encoded payload>"));' 
```
This is substituted/translated into: 
```bash
    'php -r EXEC(HEX2BIN("<hex encoded payload>"))'. 
```
The ‘p’, ‘h’, and ‘r’ are necessary as lowercase and originates from the $PATH variable which for the webserver user (www-data) is **assumed** to be ‘/opt/pihole:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin’ - this is not the case for a Pi-hole installation on Ubuntu Server with default settings.

Therefore, my PoC assumes the $PWD variable for www-data to be ‘/var/www/html/admin'. This should be the case for more types of Pi-hole installations. One problem: this path does not contain the letter ‘p’ required for a ‘php -r' execution.

**... the solution, and the full PoC is available in the PDF document**
